#!/bin/sh

eflash_dir='/lincoln/projects/eflash/trunk/'
patches_dir='/home/jupiter/lincoln.simmons/patches/'
logfile='/tmp/build.log'

cd $eflash_dir

for build in fl101 fl101m fl105 fl105m fl301 fl301aesmix fl301ax fl305m rs70 rs80; do
    echo -e "\nBuilding $build ...\n"
    make distclean > $logfile

    make $build > $logfile
    if [ $? -gt 0 ]
    then
        echo -e "\n'make $build' failed"
        exit 1
    fi

    ./tests/scurvy
    if [ $? -gt 0 ]
    then
        echo -e "\nScurvy run failed for $build build"
        exit 1
    fi

    cp src/flashcard $patches_dir/$build/flashcard
    cp src/flashcard.dmp $patches_dir/$build/flashcard.dmp
    cp src/flashcard_enc.patch $patches_dir/$build/flashcard_enc.patch
    cp src/flashcard_unenc.patch $patches_dir/$build/flashcard_unenc.patch
    cp src/FL_CPU_CODE.patch $patches_dir/$build/FL_CPU_CODE.patch
done

echo -e "\nAll builds good!\n"
